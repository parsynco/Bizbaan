export function initializeMudExRichTextEdit(t,i,r){return new n(t,i,r)}class n{elementRef;options;dotnet;quill;constructor(n,t,i){this.elementRef=n;this.dotnet=t;window.QuillBlotFormatter&&window.QuillBlotFormatter.default&&Quill.register("modules/blotFormatter",QuillBlotFormatter.default);this.create(this.options=i)}create(n){var t={debug:n.debugLevel,modules:{toolbar:n.toolBar},placeholder:n.placeholder,readOnly:n.readOnly,theme:n.theme};if(n.quillElement||this.elementRef){n.modules&&n.modules.length&&n.modules.forEach(i=>{const r=i.jsReference||window,u=i.jsConfigFunction&&r[i.jsConfigFunction]?r[i.jsConfigFunction](t,n,n.quillElement||this.elementRef):i.options;u&&(t.modules={...t.modules,...u})});this.quill=new Quill(n.quillElement||this.elementRef,t);n.beforeUpload&&!n.defaultToolHandlerNames?.includes("image")&&this.quill.getModule("toolbar").addHandler("image",()=>{const n=document.createElement("input");n.setAttribute("type","file");n.setAttribute("accept","image/*");n.click();n.onchange=()=>{const t=n.files[0];if(t){const n=new FileReader;n.onload=()=>{const i=n.result,r={data:new Uint8Array(i),fileName:t.name,extension:t.name.includes(".")?t.name.split(".").slice(-1)[0]:"",contentType:t.type,path:"",size:t.size};this.dotnet.invokeMethodAsync("UploadImage",r).then(n=>{const t=this.quill.getSelection();this.quill.insertEmbed(t.index,"image",n)}).catch(n=>console.error(n))};n.readAsArrayBuffer(t)}}});n.defaultToolHandlerNames&&n.defaultToolHandlerNames.forEach(n=>{this.quill.getModule("toolbar").addHandler(n,()=>this.dotnet.invokeMethodAsync("DelegateHandler",n,[...arguments].slice(1)))});this.quill.container.addEventListener("mouseleave",()=>{this.dotnet.invokeMethodAsync("OnMouseLeave")});this.quill.on("text-change",(n,t,i)=>{var r=this.quill.root.innerHTML;this.dotnet.invokeMethodAsync("OnContentChanged",r,i)});this.quill.on("selection-change",(n,t,i)=>{var r=this.quill.root.innerHTML;n===null&&t!==null?this.dotnet.invokeMethodAsync("OnBlur",r,i):n!==null&&t===null&&this.dotnet.invokeMethodAsync("OnFocus",r,i)});if(this.quill&&this.quill.root&&this.quill.root.parentNode){window.addEventListener("resize",this.adjustTooltipPosition.bind(this));this.interval=setInterval(this.adjustTooltipPosition.bind(this),100);const n=new ResizeObserver(n=>{if(n.length>0){var t=n[0].target.getBoundingClientRect().height;this.dotnet.invokeMethodAsync("OnHeightChanged",t)}});n.observe(this.quill.root.parentNode)}this.dotnet.invokeMethodAsync("OnCreated")}}stopRecording(){this.recognition&&(this.recognition.stop(),this.recognition=null)}startRecording(){if("webkitSpeechRecognition"in window){this.recognition=new webkitSpeechRecognition;this.recognition.lang="de-DE";this.recognition.continuous=!0;this.recognition.interimResults=!0;let n=!1;return this.recognition.onresult=t=>{let i="";for(let r=t.resultIndex;r<t.results.length;++r)t.results[r].isFinal?(n=!0,i+=t.results[r][0].transcript+"\n"):i+=t.results[r][0].transcript;let r=this.quill.getSelection()?this.quill.getSelection().index:this.quill.getLength();n&&(this.quill.insertText(r,i,"user"),this.quill.setSelection(r+i.length),n=!1)},this.recognition.start(),!0}return!1}adjustTooltipPosition(){var t=window.getComputedStyle(this.quill.root.parentNode).getPropertyValue("resize"),n,i,r;t&&t!=="none"&&(n=this.elementRef.querySelector(".ql-tooltip"),n&&(i=parseInt(window.getComputedStyle(n).left,10),r=parseInt(window.getComputedStyle(n).top,10),i<0&&(n.style.left="0px"),r<10&&(n.style.top="10px")))}insertImage(n){var i=Quill.import("delta"),t=0;return this.quill.getSelection()!==null&&(t=this.quill.getSelection().index),this.quill.updateContents((new i).retain(t).insert({image:n},{alt:n}))}insertMarkup(n){let t=this.quill.getSelection()?.index??this.quill.getLength();this.quill.clipboard.dangerouslyPasteHTML(t,n);this.quill.setSelection(t+n.length)}dispose(){clearInterval(this.interval);this.stopRecording()}}window.MudExRichTextEdit=n;