export function initializeMudExColorBubble(t,i,r,u){return new n(t,i,r,u)}class n{elementRef;options;dotnet;canvas;_canvasContainer;_previewControl;color;_el;constructor(n,t,i,r){this.elementRef=n;this._canvasContainer=t;this.dotnet=i;this.setOptions(r)}canvasContainer(){return new MudExDomHelper(this._canvasContainer)}el(){return this._el||(this._el=new MudExDomHelper(this.elementRef))}init(){document.body.addEventListener("mousedown",this._onBodyClick.bind(this))}setOptions(n){this.options=n||{selectorSize:161,minLuminance:17,maxLuminance:86,showColorPreview:!0};this.options.selectorSize=this.options.selectorSize%2!=0?this.options.selectorSize:this.options.selectorSize+1;this.color=n.color}_onBodyClick(n){MudExEventHelper.isWithin(n,this._canvasContainer)||MudExEventHelper.isWithin(n,this._previewControl)||this.hideSelector()}setColor(n){this.color=n;this.el().setStyle({backgroundColor:this.color,borderColor:MudExColorHelper.perceivedBrightness(this.color)>230?MudExColorHelper.setLuminance(this.color,.4):"transparent"});this._updateLocator();this.dotnet.invokeMethodAsync("OnColorChanged",this.color)}dispose(){document.body.removeEventListener("mousedown",this._onBodyClick.bind(this))}showSelector(){this._canvasContainer.classList.contains("mud-ex-color-bubble-canvas-container-small")||this._canvasContainer.classList.add("mud-ex-color-bubble-canvas-container-small");this.canvasContainer().show();this.canvas=this._buildCanvas();this._canvasContainer.insertBefore(this.canvas,this._canvasContainer.firstChild);this.options.showColorPreview&&(this._previewControl=document.createElement("div"),this._previewControl.className="mud-ex-color-bubble-preview mud-ex-transparent",this._previewControl.style.backgroundColor=this.elementRef.style.backgroundColor,this.options.allowSelectOnPreviewClick&&(this._previewControl.style.cursor="pointer",this._previewControl.onclick=this._onPreviewClick.bind(this)),this._previewControl.onmousemove=n=>{n.stopPropagation(),this._previewControl.style.backgroundColor=this.elementRef.style.backgroundColor},this._canvasContainer.insertBefore(this._previewControl,this._canvasContainer.firstChild));this._canvasContainer.ontransitionend=this._onShowEnd.bind(this);this._updateLocator();this.canvasContainer().setStyle({left:this.el().getX()+this.el().getWidth()/2-this.options.selectorSize/2+"px",top:this.el().getY()+this.el().getHeight()/2-this.options.selectorSize/2+"px"}).show().removeCls("mud-ex-color-bubble-canvas-container-small")}_onPreviewClick(n){n.stopPropagation();this.hideSelector();this.dotnet.invokeMethodAsync("OnColorPreviewClick")}_onClick(n){this.showSelector(n)}_buildCanvas(){var u=document.createElement("canvas");u.height=this.options.selectorSize;u.width=this.options.selectorSize;for(var t=u.getContext("2d"),n=this.options.selectorSize/2,h=Math.PI/180,c=360/(4*Math.PI*this.options.selectorSize),s=(this.options.maxLuminance+this.options.minLuminance)/2,f,e,o,r,i=0;i<360;i+=c)f=i*h,e=n+n*Math.cos(f),o=n+n*Math.sin(f),r=t.createLinearGradient(n,n,e,o),r.addColorStop(0,`hsl(${i}, 100%, ${this.options.maxLuminance}%)`),r.addColorStop((100-s)/100,`hsl(${i}, 100%, ${s}%)`),r.addColorStop(1,`hsl(${i}, 100%, ${this.options.minLuminance}%)`),t.strokeStyle=r,t.beginPath(),t.moveTo(n,n),t.lineTo(e,o),t.stroke(),t.closePath();return u}_onCanvasMouseOut(){new MudExDomHelper(this._previewControl).setStyle({backgroundColor:this.color})}_onCanvasMouseMove(n){new MudExDomHelper(this._previewControl).setStyle({backgroundColor:this._getColorFromEvent(n)||this.color})}_getColorFromPosition(n){var t=this.options.selectorSize/2,i=n.y-t,r=n.x-t,u=360-(Math.atan2(-i,r)+2*Math.PI)*180/Math.PI%360,f=Math.sqrt(r*r+i*i),e=this.options.minLuminance+(this.options.maxLuminance-this.options.minLuminance)*(-f/t+1);return MudExColorHelper.hslToHex({h:MudExNumber.constrain(u,0,360)/360,s:1,l:MudExNumber.constrain(e,0,100)/100})}_getPositionFromColor(n){var i=MudExColorHelper.hexToHsl(n),t=this.options.selectorSize/2,r=(360-i.h*360)*Math.PI/180,f=t*(1-(i.l*100-this.options.minLuminance)/(this.options.maxLuminance-this.options.minLuminance)),u=MudExNumber.constrain(f,0,t);return{x:Math.round(u*Math.cos(r)+t),y:Math.round(t-u*Math.sin(r))}}_getColorFromEvent(n){return MudExEventHelper.isWithin(n,this.canvas)?this._getColorFromPosition({x:n.clientX-this.canvasContainer().getX(),y:n.clientY-this.canvasContainer().getY()}):null}_updateLocator(){if(this._canvasContainer&&this.canvasContainer().isVisible()){var n=this._getPositionFromColor(this.color),t=this.canvasContainer().down(".mud-ex-color-bubble-locator");t.setStyle({left:n.x+"px",top:n.y+"px",borderColor:MudExColorHelper.getOptimalForegroundColor(this.color)})}}_onCanvasClick(n){if(!MudExEventHelper.isWithin(n,this._previewControl)){var t=this._getColorFromEvent(n);t&&this.setColor(t);this.options.closeAfterSelect&&this.hideSelector()}}hideSelector(){this.options.showColorPreview&&this._previewControl?.remove();this._canvasContainer.ontransitionend=this._onHideEnd.bind(this);this.canvasContainer().addCls("mud-ex-color-bubble-canvas-container-small")}_onHideEnd(){this.canvasContainer().hide();this.canvas.remove();this._canvasContainer.ontransitionend=null;this._canvasContainer.onmousemove=null;this._canvasContainer.onmouseout=null;this._canvasContainer.onclick=null}_onShowEnd(){this.options.showColorPreview&&(new MudExDomHelper(this._previewControl).removeCls("mud-ex-transparent"),this._canvasContainer.onmousemove=this._onCanvasMouseMove.bind(this),this._canvasContainer.onmouseout=this._onCanvasMouseOut.bind(this));this._canvasContainer.onclick=this._onCanvasClick.bind(this);this._canvasContainer.ontransitionend=null}}window.MudExColorBubble=n;